@model EBookDashboard.Models.DashboardIndexViewModel
@{
    ViewData["Title"] = "Dashboard";
   Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBook Ai Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Add jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* ===== VARIABLES ===== */
        :root {
            --primary: #4a6cf7;
            --primary-dark: #3a5cf6;
            --primary-light: #667eea;
            --secondary: #7e57c2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --border-radius: 12px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #f5f7fb;
            color: var(--gray-700);
            line-height: 1.6;
        }

        /* ===== MODAL CENTERING ===== */
        .modal {
            display: none;
        }

        .modal.show {
            display: block;
        }

        .modal.fade .modal-dialog {
            transition: transform 0.3s ease-out;
            transform: translate(0, -50px);
        }

        .modal.show .modal-dialog {
            transform: none;
        }

        .modal-dialog-centered {
            display: flex;
            align-items: center;
            min-height: calc(100% - 1rem);
        }

        @@media (min-width: 576px) {
            .modal-dialog-centered {
                min-height: calc(100% - 3.5rem);
            }
        }

        .dashboard-wrapper {
            padding: 24px;
            max-width: 1653px;
            margin: 0 auto;
        }

        /* ===== HEADER STYLES ===== */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 20px;
            text-align:left;
        }

        .header-content h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            line-height: 1.2;
        }

        .header-content p {
            font-size: 1.1rem;
            color: var(--gray-500);
            margin: 8px 0 0 0;
            font-weight: 500;
        }

        .user-greeting {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 20px 28px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

            .user-greeting::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 100px;
                height: 100px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50%;
                transform: translate(30px, -30px);
            }

            .user-greeting:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow-lg);
            }

            .user-greeting h2 {
                margin: 0 0 8px 0;
                font-size: 1.5rem;
                font-weight: 700;
                position: relative;
                z-index: 1;
            }

            .user-greeting p {
                margin: 0;
                opacity: 0.9;
                font-size: 1rem;
                position: relative;
                z-index: 1;
            }

        /* ===== STATS SECTION ===== */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--gray-200);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

            .stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: linear-gradient(90deg, var(--primary), var(--primary-light));
            }

            .stat-card:hover {
                transform: translateY(-8px);
                box-shadow: var(--shadow-lg);
            }

        .stat-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 1.8rem;
            color: white;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--dark), var(--gray-700));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        /* ===== CURRENT BOOK SECTION ===== */
        .current-book-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius);
            padding: 32px;
            color: white;
            margin-bottom: 32px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

            .current-book-display::before {
                content: '';
                position: absolute;
                top: -50%;
                right: -50%;
                width: 100%;
                height: 200%;
                background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            }

        .current-book-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
            position: relative;
            z-index: 1;
        }

            .current-book-header h2 {
                margin: 0;
                font-size: 1.8rem;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 12px;
            }

        .book-info-card {
            display: flex;
            align-items: center;
            gap: 24px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .book-cover {
            width: 100px;
            height: 140px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

            .book-cover:hover {
                transform: scale(1.05);
                background: rgba(255, 255, 255, 0.25);
            }

        .book-details {
            flex: 1;
            min-width: 250px;
        }

        .book-name {
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }



        .book-id {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 12px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 6px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
        }

        /* ===== BUTTON STYLES ===== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.5s;
            }

            .btn:hover::before {
                left: 100%;
            }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: var(--shadow);
        }

            .btn-primary:hover {
                background: linear-gradient(135deg, var(--primary-dark), var(--primary));
                transform: translateY(-3px);
                box-shadow: var(--shadow-md);
            }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

            .btn-secondary:hover {
                background: white;
                transform: translateY(-3px);
                box-shadow: var(--shadow);
                border-color: var(--gray-400);
            }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            box-shadow: var(--shadow);
        }

            .btn-success:hover {
                background: linear-gradient(135deg, #0da271, #04865d);
                transform: translateY(-3px);
                box-shadow: var(--shadow-md);
            }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

            .btn-outline:hover {
                background: rgba(255, 255, 255, 0.1);
                border-color: white;
                transform: translateY(-3px);
            }

        .book-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* ===== PROJECTS SECTION ===== */
        .projects-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

            .section-title i {
                color: var(--primary);
                background: var(--gray-100);
                width: 40px;
                height: 40px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        .project-card {
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 24px;
            transition: var(--transition);
            background: white;
            position: relative;
            overflow: hidden;
        }

            .project-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 6px;
                height: 100%;
                background: linear-gradient(to bottom, var(--primary), var(--primary-light));
            }

            .project-card:hover {
                box-shadow: var(--shadow-lg);
                transform: translateY(-5px);
            }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

            .project-header h3 {
                font-size: 1.3rem;
                color: var(--dark);
                margin: 0;
                flex: 1;
                font-weight: 600;
                line-height: 1.4;
            }

        .project-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

            .project-status.active {
                background: #dcfce7;
                color: #166534;
            }

            .project-status.review {
                background: #ffedd5;
                color: #c2410c;
            }

            .project-status.draft {
                background: #e0f2fe;
                color: #0c4a6e;
            }

        .project-progress {
            margin-bottom: 24px;
        }

        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

            .progress-fill::after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
                animation: shimmer 2s infinite;
            }

        @@keyframes shimmer {
            0%

        {
            left: -100%;
        }

        100% {
            left: 100%;
        }

        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .control-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* ===== PREMIUM SECTION ===== */
        .premium-section {
            background: linear-gradient(135deg, #1e3a8a, #312e81);
            border-radius: var(--border-radius);
            padding: 40px;
            color: white;
            margin-bottom: 32px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

            .premium-section::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.05)"/></svg>');
                background-size: cover;
            }

            .premium-section h3 {
                font-size: 2rem;
                margin-bottom: 16px;
                display: flex;
                align-items: center;
                gap: 12px;
                position: relative;
                z-index: 1;
            }

            .premium-section p {
                font-size: 1.1rem;
                opacity: 0.9;
                margin-bottom: 32px;
                position: relative;
                z-index: 1;
                max-width: 853px;
            }

        .premium-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
            position: relative;
            z-index: 1;
        }

        .feature-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

            .feature-item:hover {
                background: rgba(255, 255, 255, 0.15);
                transform: translateY(-8px);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            }

            .feature-item i {
                font-size: 2.5rem;
                color: white;
            }

            .feature-item span {
                font-size: 1.1rem;
                font-weight: 600;
            }

        .premium-buttons {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        /* ===== ENHANCED CONTENT SECTION ===== */
        .enhanced-content-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .content-card {
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 24px;
            transition: var(--transition);
            background: white;
            position: relative;
            overflow: hidden;
        }

            .content-card:hover {
                box-shadow: var(--shadow-md);
                transform: translateY(-5px);
            }

        .content-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .content-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .content-card h3 {
            font-size: 1.3rem;
            color: var(--dark);
            margin: 0;
            font-weight: 600;
        }

        .content-card p {
            color: var(--gray-600);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .content-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

            .content-list li {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 8px 0;
                color: var(--gray-600);
            }

                .content-list li i {
                    color: var(--success);
                    font-size: 0.9rem;
                }

        .content-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

            .content-actions .btn {
                flex: 1;
            }

        /* ===== RESPONSIVE DESIGN ===== */
        @@media (max-width: 1200px) {
            .dashboard-wrapper

        {
            padding: 20px;
        }

        }

        @@media (max-width: 768px) {
            .dashboard-wrapper

        {
            padding: 16px;
        }

        .dashboard-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .header-content h1 {
            font-size: 2rem;
        }

        .user-greeting {
            width: 100%;
        }

        .stats-section {
            grid-template-columns: repeat(2, 1fr);
        }

        .projects-grid {
            grid-template-columns: 1fr;
        }

        .book-info-card {
            flex-direction: column;
            align-items: flex-start;
        }

        .book-actions {
            width: 100%;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }

        .premium-section {
            padding: 24px;
        }

        .premium-features {
            grid-template-columns: 1fr;
        }

        .premium-buttons {
            flex-direction: column;
        }

        .content-grid {
            grid-template-columns: 1fr;
        }

        }

        @@media (max-width: 480px) {
            .stats-section

        {
            grid-template-columns: 1fr;
        }

        .header-content h1 {
            font-size: 1.8rem;
        }

        .current-book-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .control-actions {
            width: 100%;
        }

            .control-actions .btn {
                flex: 1;
            }

        }

        /* ===== ANIMATIONS ===== */
        @@keyframes fadeIn {
            from

        {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }

        }

        .stat-card, .project-card, .content-card, .feature-item {
            animation: fadeIn 0.6s ease forwards;
        }

            .stat-card:nth-child(2) {
                animation-delay: 0.1s;
            }

            .stat-card:nth-child(3) {
                animation-delay: 0.2s;
            }

            .stat-card:nth-child(4) {
                animation-delay: 0.3s;
            }

        /* ===== SCROLLBAR STYLING ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: var(--gray-500);
            }
    </style>
</head>
<body>
    <div class="dashboard-wrapper">
        <!-- Header with User Greeting -->
        <div class="dashboard-header">
            <div class="header-content">
                <h1>Dashboard</h1>
                <p>Your complete eBook publishing command center</p>
            </div>
            <div class="user-greeting">
                <h2>Welcome back, @Model.UserName!</h2>
                <p style="color:white;">Ready to Explore Amazing Books!</p>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-number">@Model.TotalBooksPublished</div>
                <div class="stat-label">Books Published</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-number">@Model.MonthlyRevenue.ToString("C")</div>
                <div class="stat-label">Monthly Revenue</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-download"></i>
                </div>
                <div class="stat-number">@Model.TotalDownloads</div>
                <div class="stat-label">Total Downloads</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-number">@Model.AverageRating</div>
                <div class="stat-label">Average Rating</div>
            </div>
        </div>

        <!-- Current Working Book -->
        <div class="current-book-display">
            <div class="current-book-header">
                <h2><i class="fas fa-book-open"></i> Currently Working On</h2>
                <div class="book-actions">
                    <button class="btn btn-outline" onclick="editCurrentBook()">
                        <i class="fas fa-edit"></i> Edit Book
                    </button>
                    <button class="btn btn-outline" onclick="viewBookDetails()">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                </div>
            </div>
            <div class="book-info-card">
                <div class="book-cover">
                    <i class="fas fa-book"></i>
                </div>
                <div class="book-details">
                    <div class="book-name" id="currentBookName">@Model.CurrentWorkingBook?.Title</div>
                    <div class="book-id" id="currentBookId">@Model.CurrentWorkingBook?.BookIdText</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: @Model.CurrentWorkingBook?.ProgressPercentage%"></div>
                        </div>
                        <div class="progress-text">
                            <span>Progress</span>
                            <span>@Model.CurrentWorkingBook?.ProgressText</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Projects -->
        <div class="projects-section">
            <h2 class="section-title"><i class="fas fa-project-diagram"></i> Current Projects</h2>
            <div class="projects-grid">
                @if (Model.CurrentProjects != null && Model.CurrentProjects.Any())
                {
                    foreach (var p in Model.CurrentProjects)
                    {
                        var statusClass = p.Status == "Published" ? "project-status active" : (p.Status == "Draft" ? "project-status draft" : "project-status review");
                        <div class="project-card">
                            <div class="project-header">
                                <h3>@p.Title</h3>
                                <span class="@statusClass">@p.Status</span>
                            </div>
                            <div class="project-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: @p.ProgressPercentage%"></div>
                                </div>
                                <div class="progress-info">
                                    <span>@p.ProgressPercentage% Complete</span>
                                    <span>@p.ProgressText</span>
                                </div>
                            </div>
                            <div class="control-actions">
                                <button class="btn btn-primary" onclick="editProject(@p.BookId)">
                                    <i class="fas fa-edit"></i> Continue
                                </button>
                                <button class="btn btn-secondary" onclick="previewProject(@p.BookId)">
                                    <i class="fas fa-eye"></i> Preview
                                </button>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="project-card">
                        <div class="project-header">
                            <h3>No projects yet</h3>
                            <span class="project-status draft">Start</span>
                        </div>
                        <div class="project-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-info">
                                <span>0% Complete</span>
                                <span>Create your first book to begin</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Premium Features -->
        <div class="premium-section" id="premium-section">
            <h3><i class="fas fa-crown"></i> Unlock Premium Features</h3>
            <p>Take your publishing to the next level with our premium tools and services designed for professional authors</p>

            <div class="premium-features">
                <div class="feature-item" data-feature-type="AI Cover Design" onclick="showFeatureModal('AI Cover Design')">
                    <i class="fas fa-palette"></i>
                    <span style="color:white;">AI Cover Design</span>
                </div>
                <div class="feature-item" data-feature-type="Audio Book Creation" onclick="showFeatureModal('Audio Book Creation')">
                    <i class="fas fa-microphone"></i>
                    <span style="color:white;">Audio Book Creation</span>
                </div>
                <div class="feature-item" data-feature-type="Advanced Analytics" onclick="showFeatureModal('Advanced Analytics')">
                    <i class="fas fa-chart-bar"></i>
                    <span style="color:white;">Advanced Analytics</span>
                </div>
                <div class="feature-item" data-feature-type="Priority Support" onclick="showFeatureModal('Priority Support')">
                    <i class="fas fa-rocket"></i>
                    <span style="color:white;">Priority Support</span>
                </div>
            </div>

            <div class="premium-buttons">
                <button class="btn btn-primary" onclick="showPricingPlans()">
                    <i class="fas fa-crown"></i> View All Plans
                </button>
                <button class="btn btn-outline" onclick="showFeatureModal('Premium Features')">
                    <i class="fas fa-info-circle"></i> Feature Details
                </button>
                <button class="btn btn-success" id="checkoutButton" style="display: none;">
                    <i class="fas fa-shopping-cart"></i> Checkout (<span id="cartItemCount">0</span>)
                </button>
            </div>
        </div>

        <!-- Content Section with Tabs -->
        <div class="enhanced-content-section" id="content-section">
            <h2 class="section-title"><i class="fas fa-lightbulb"></i> Publishing Insights & Resources</h2>
            
            <!-- Tab Navigation -->
            <ul class="nav nav-tabs" id="contentTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab" aria-controls="analytics" aria-selected="true">Analytics</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="marketing-tab" data-bs-toggle="tab" data-bs-target="#marketing" type="button" role="tab" aria-controls="marketing" aria-selected="false">Marketing</button>
                </li>
            </ul>
            
            <!-- Tab Content -->
            <div class="tab-content" id="contentTabContent">
                <!-- Analytics Tab -->
                <div class="tab-pane fade show active" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
                    <div class="content-card">
                        <div class="content-card-header">
                            <div class="content-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h3>Performance Analytics</h3>
                        </div>
                        <p>Track your book's performance across different platforms and markets.</p>
                        <ul class="content-list">
                            <li><i class="fas fa-check"></i> Sales trends by region</li>
                            <li><i class="fas fa-check"></i> Reader engagement metrics</li>
                            <li><i class="fas fa-check"></i> Revenue breakdown by platform</li>
                            <li><i class="fas fa-check"></i> Comparative performance analysis</li>
                        </ul>
                        <div class="content-actions">
                            <button class="btn btn-primary" onclick="viewAnalytics()">
                                <i class="fas fa-chart-line"></i> View Analytics
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Marketing Tab -->
                <div class="tab-pane fade" id="marketing" role="tabpanel" aria-labelledby="marketing-tab">
                    <div class="content-card">
                        <div class="content-card-header">
                            <div class="content-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <h3>Marketing Tools</h3>
                        </div>
                        <p>Promote your eBook effectively with our integrated marketing toolkit.</p>
                        <ul class="content-list">
                            <li><i class="fas fa-check"></i> Social media campaign builder</li>
                            <li><i class="fas fa-check"></i> Email marketing templates</li>
                            <li><i class="fas fa-check"></i> Promotional pricing strategies</li>
                            <li><i class="fas fa-check"></i> Reader outreach automation</li>
                        </ul>
                        <div class="content-actions">
                            <button class="btn btn-primary" onclick="launchMarketing()">
                                <i class="fas fa-rocket"></i> Launch Campaign
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Anti-Forgery Token -->
        @Html.AntiForgeryToken()

        <!-- Feature Modal with Outstanding UI - Maximum 700px Width -->
        <div class="modal fade" id="featureModal" tabindex="-1" role="dialog" aria-labelledby="featureModalLabel" style="display: none;">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document" style="max-width: 700px; width: 95%; margin: 1.75rem auto;">
                <div class="modal-content" style="border: none; border-radius: 24px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
                    <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 30px 40px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                            <div>
                                <h4 class="modal-title" id="featureModalLabel" style="color: white; font-weight: 800; font-size: 1.8rem; margin: 0; display: flex; align-items: center; gap: 12px;">
                                    <i class="fas fa-crown" style="font-size: 1.5rem;"></i>
                                    <span>Premium Features</span>
                                </h4>
                                <p style="color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 1rem;">Select features to unlock professional publishing tools</p>
                            </div>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="background: rgba(255,255,255,0.2); border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; opacity: 1; transition: all 0.3s ease; background-image: none;">
                                <span aria-hidden="true" style="line-height: 1;">&times;</span>
                            </button>
                        </div>
                    </div>
                    <div class="modal-body" id="featureModalBody" style="padding: 30px; background: #f8fafc; max-height: 70vh; overflow-y: auto; overflow-x: hidden;">
                        <!-- Content will be loaded via AJAX -->
                        <div class="text-center" style="padding: 40px;">
                            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <p style="margin-top: 20px; color: #64748b; font-size: 1.1rem;">Loading premium features...</p>
                        </div>
                    </div>
                    <div class="modal-footer" style="background: white; border-top: 2px solid #e2e8f0; padding: 25px 40px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <strong style="color: #1e293b; font-size: 1.1rem;">Total Selected:</strong>
                            <span id="modalTotalAmount" style="font-size: 1.5rem; font-weight: 800; color: #4a6cf7;">$0.00</span>
                        </div>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="padding: 12px 24px; border-radius: 12px; font-weight: 600;">
                                <i class="fas fa-times"></i> Close
                            </button>
                            <button type="button" class="btn btn-primary" id="addToCartModalBtn" style="padding: 12px 32px; border-radius: 12px; font-weight: 600; background: linear-gradient(135deg, #4a6cf7, #667eea); border: none; box-shadow: 0 4px 14px 0 rgba(74, 108, 247, 0.4);">
                                <i class="fas fa-cart-plus"></i> Add Selected Features to Cart
                            </button>
                            <button type="button" class="btn btn-success" id="checkoutModalBtn" style="padding: 12px 32px; border-radius: 12px; font-weight: 600; background: linear-gradient(135deg, #10b981, #059669); border: none; box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.4); display: none;">
                                <i class="fas fa-arrow-right"></i> Proceed to Checkout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Dashboard JavaScript with animations and interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Setup CSRF token for AJAX requests
            setupCSRFToken();
            
            // Initialize components
            initializeDashboard();

            // Show welcome message
            showWelcomeMessage();

            // Add scroll animations
            addScrollAnimations();
        });

        // Setup CSRF token for AJAX requests
        function setupCSRFToken() {
            const token = $('input[name="__RequestVerificationToken"]').val();
            if (token) {
                // Setup jQuery AJAX defaults
                $.ajaxSetup({
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('RequestVerificationToken', token);
                    }
                });
                window.csrfToken = token;
            }
        }

        // Initialize dashboard components
        function initializeDashboard() {
            // Add hover effects to cards
            const cards = document.querySelectorAll('.stat-card, .project-card, .feature-item, .content-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px)';
                });

                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });

            // Initialize feature items
            initializeFeatureItems();

            // Initialize progress bars animation
            animateProgressBars();
            
            // Load cart item count
            loadCartItemCount();
        }

        // Load cart item count
        function loadCartItemCount() {
            $.get('/Features/GetCartSummary')
                .done(function(data) {
                    if (data.success) {
                        $('#cartItemCount').text(data.count);
                        if (data.count > 0) {
                            $('#checkoutButton').show();
                        } else {
                            $('#checkoutButton').hide();
                        }
                    }
                })
                .fail(function() {
                    // Silently fail if cart count can't be loaded
                    console.log('Failed to load cart item count');
                });
        }

        // Show welcome message with enhanced styling
        function showWelcomeMessage() {
            if (!sessionStorage.getItem('welcomeShown')) {
                Swal.fire({
                    title: `<div style="font-size: 2rem; background: linear-gradient(135deg, #4a6cf7, #667eea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;">Welcome Back!</div>`,
                    html: `<div style="font-size: 1.2rem; color: #475569; margin-top: 10px;">Hello <strong>Author</strong>, ready to explore amazing books?</div>`,
                    icon: 'success',
                    timer: 3000,
                    timerProgressBar: true,
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    background: 'white',
                    customClass: {
                        popup: 'animated-popup'
                    }
                });
                sessionStorage.setItem('welcomeShown', 'true');
            }
        }

        // Animate progress bars on scroll
        function animateProgressBars() {
            const progressBars = document.querySelectorAll('.progress-fill');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const progressBar = entry.target;
                        const width = progressBar.style.width;
                        progressBar.style.width = '0%';

                        setTimeout(() => {
                            progressBar.style.transition = 'width 1.5s ease-in-out';
                            progressBar.style.width = width;
                        }, 300);

                        observer.unobserve(progressBar);
                    }
                });
            }, { threshold: 0.5 });

            progressBars.forEach(bar => observer.observe(bar));
        }

        // Add scroll animations to elements
        function addScrollAnimations() {
            const animatedElements = document.querySelectorAll('.stat-card, .project-card, .feature-item, .content-card');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });

            animatedElements.forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(el);
            });
        }

        // Initialize feature item click handlers
        function initializeFeatureItems() {
            $('.feature-item').on('click', function() {
                const featureType = $(this).data('feature-type');
                showFeatureModal(featureType);
            });
            
            // Initialize checkout button
            $('#checkoutButton').on('click', function() {
                window.location.href = '/Payments/PaymentSummary';
            });
            
            // Initialize checkout modal button
            $('#checkoutModalBtn').on('click', function() {
                window.location.href = '/Payments/PaymentSummary';
            });
            
            // Initialize modal add to cart button
            $('#addToCartModalBtn').off('click').on('click', function() {
                addSelectedToCart();
            });
        }

        // Initialize feature card handlers for dynamic content
        function initializeFeatureCardHandlers() {
            // Toggle selected state on card click
            $('.feature-card-modern').off('click').on('click', function(e) {
                // Don't toggle if clicking on checkbox directly
                if (e.target.type !== 'checkbox' && !$(e.target).closest('.feature-checkbox-custom').length) {
                    const checkbox = $(this).find('.feature-checkbox');
                    if (checkbox.length) {
                        checkbox.prop('checked', !checkbox.prop('checked'));
                        toggleCardSelection(this, checkbox.prop('checked'));
                        // Trigger change event to update total
                        checkbox.trigger('change');
                    }
                }
            });

            // Update card appearance when checkbox changes
            $('.feature-checkbox').off('change').on('change', function() {
                const card = $(this).closest('.feature-card-modern');
                toggleCardSelection(card[0], this.checked);
            });
        }

        // Toggle card selection styling
        function toggleCardSelection(card, isSelected) {
            if (isSelected) {
                $(card).addClass('selected');
            } else {
                $(card).removeClass('selected');
            }
        }

        // Show feature modal
        function showFeatureModal(featureType) {
            // Check if CSRF token exists (indicates page is loaded properly)
            const csrfToken = $('input[name="__RequestVerificationToken"]').val();
            if (!csrfToken) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Session Expired',
                    text: 'Your session has expired. Please refresh the page and login again.',
                    confirmButtonText: 'Refresh Page'
                }).then(() => {
                    window.location.reload();
                });
                return;
            }
            
            // Show loading state
            $('#featureModalLabel').html('<i class="fas fa-crown"></i> ' + featureType + ' Features');
            $('#featureModalBody').html('<div class="text-center" style="padding: 40px;"><i class="fas fa-spinner fa-spin fa-3x" style="color: #4a6cf7;"></i><p style="margin-top: 20px; color: #64748b;">Loading premium features...</p></div>');
            
            // Show modal using Bootstrap 5 API
            const modalElement = document.getElementById('featureModal');
            if (modalElement) {
                // Remove aria-hidden from modal when showing (Bootstrap will manage it)
                modalElement.removeAttribute('aria-hidden');
                
                // Get or create Bootstrap 5 Modal instance
                let modalInstance = bootstrap.Modal.getInstance(modalElement);
                if (!modalInstance) {
                    modalInstance = new bootstrap.Modal(modalElement, {
                        backdrop: true,
                        keyboard: true,
                        focus: true
                    });
                }
                
                // Handle modal events to fix accessibility
                modalElement.addEventListener('shown.bs.modal', function() {
                    // Remove aria-hidden from dashboard-container when modal is shown
                    const dashboardContainer = document.querySelector('.dashboard-container');
                    if (dashboardContainer) {
                        dashboardContainer.removeAttribute('aria-hidden');
                    }
                });
                
                modalElement.addEventListener('hidden.bs.modal', function() {
                    // Restore aria-hidden state after modal is closed if needed
                    // Bootstrap handles this automatically, but we ensure it's clean
                });
                
                modalInstance.show();
                
                // Ensure modal is visible and centered after showing
                setTimeout(function() {
                    const modalDialog = modalElement.querySelector('.modal-dialog');
                    if (modalDialog) {
                        modalDialog.style.margin = '1.75rem auto';
                        modalDialog.style.display = 'flex';
                        modalDialog.style.alignItems = 'center';
                        modalDialog.style.minHeight = 'calc(100% - 3.5rem)';
                    }
                }, 100);
            } else {
                console.error('Modal element not found');
            }
            
            // Load feature details via AJAX
            // Ensure cookies are sent with the request
            $.ajax({
                url: `/Features/GetFeatureDetails/${encodeURIComponent(featureType)}`,
                type: 'GET',
                cache: false,
                dataType: 'text',
                xhrFields: {
                    withCredentials: true // Send cookies with request
                },
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                beforeSend: function(xhr, settings) {
                    // Explicitly ensure credentials are sent for cookie authentication
                    xhr.withCredentials = true;
                    console.log('Requesting features with credentials:', featureType);
                },
                success: function(data, textStatus, xhr) {
                    // Check if response is JSON (error)
                    let responseData = data;
                    const contentType = xhr.getResponseHeader('Content-Type') || '';
                    
                    if (contentType.includes('application/json')) {
                        try {
                            responseData = JSON.parse(data);
                            if (responseData.error) {
                                $('#featureModalBody').html(`
                                    <div style="text-align: center; padding: 40px;">
                                        <div style="width: 80px; height: 80px; background: #fef3c7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                                            <i class="fas fa-user-lock" style="font-size: 2rem; color: #f59e0b;"></i>
                                        </div>
                                        <h3 style="color: #1e293b; margin-bottom: 12px;">Authentication Required</h3>
                                        <p style="color: #64748b; margin-bottom: 24px;">${responseData.message || 'Please login to access features'}</p>
                                        <button class="btn btn-primary" onclick="window.location.href='/Account/Login'" style="padding: 12px 24px; border-radius: 12px;">
                                            <i class="fas fa-sign-in-alt"></i> Go to Login
                                        </button>
                                    </div>
                                `);
                                return;
                            }
                        } catch (e) {
                            console.error('Error parsing JSON response:', e);
                        }
                    }
                    
                    // Assume it's HTML from PartialView
                    $('#featureModalBody').html(responseData);
                    
                    // Calculate initial total
                    calculateTotal();
                    
                    // Attach event listeners to checkboxes
                    $('.feature-checkbox').off('change').on('change', function() {
                        calculateTotal();
                    });
                    
                    // Ensure all checkboxes have data-price attribute set
                    $('.feature-checkbox').each(function() {
                        const checkbox = $(this);
                        if (!checkbox.attr('data-price') || parseFloat(checkbox.attr('data-price')) <= 0) {
                            // Try to get price from the feature card
                            const featureCard = checkbox.closest('.feature-card-modern, .feature-card');
                            let priceText = featureCard.find('.feature-price-current').first().text();
                            if (!priceText || priceText.trim() === '') {
                                priceText = featureCard.attr('data-feature-price');
                            }
                            if (priceText) {
                                const price = parseFloat(priceText.replace(/[^0-9.-]+/g,""));
                                if (!isNaN(price) && price > 0) {
                                    checkbox.attr('data-price', price);
                                }
                            }
                        }
                    });
                    
                    // Also use the calculateTotal from the loaded view if available
                    if (typeof window.calculateTotal === 'function') {
                        // Use the one from FeatureDetails.cshtml as it's more reliable
                        setTimeout(function() {
                            calculateTotal();
                        }, 100);
                    }
                    
                    // Attach event listeners to add to cart buttons
                    $('#addToCartBtn').on('click', function() {
                        addSelectedToCart();
                    });
                    
                    // Attach event listener to modal add to cart button
                    $('#addToCartModalBtn').on('click', function() {
                        addSelectedToCart();
                    });
                    
                    // Re-initialize card click handlers for new content
                    setTimeout(function() {
                        initializeFeatureCardHandlers();
                        // Ensure calculateTotal is called after handlers are set up
                        calculateTotal();
                    }, 150);
                },
                error: function(xhr, status, error) {
                    console.error('Error loading features:', {
                        status: xhr.status,
                        statusText: xhr.statusText,
                        error: error,
                        responseText: xhr.responseText
                    });
                    
                    if (xhr.status === 401 || xhr.status === 403) {
                        // Try to parse error response
                        let errorMessage = 'Your session has expired. Please refresh the page and log in again.';
                        try {
                            if (xhr.responseText) {
                                const errorData = JSON.parse(xhr.responseText);
                                if (errorData && errorData.message) {
                                    errorMessage = errorData.message;
                                }
                            }
                        } catch (e) {
                            // Use default message
                        }
                        
                        $('#featureModalBody').html(`
                            <div style="text-align: center; padding: 40px;">
                                <div style="width: 80px; height: 80px; background: #fef3c7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                                    <i class="fas fa-user-lock" style="font-size: 2rem; color: #f59e0b;"></i>
                                </div>
                                <h3 style="color: #1e293b; margin-bottom: 12px;">Authentication Required</h3>
                                <p style="color: #64748b; margin-bottom: 24px;">${errorMessage}</p>
                                <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px;">
                                    <button class="btn btn-primary" onclick="window.location.reload()" style="padding: 12px 24px; border-radius: 12px;">
                                        <i class="fas fa-sync-alt"></i> Refresh Page
                                    </button>
                                    <button class="btn btn-secondary" onclick="window.location.href='/Account/Login'" style="padding: 12px 24px; border-radius: 12px;">
                                        <i class="fas fa-sign-in-alt"></i> Go to Login
                                    </button>
                                </div>
                            </div>
                        `);
                    } else {
                        $('#featureModalBody').html(`
                            <div style="text-align: center; padding: 40px;">
                                <div style="width: 80px; height: 80px; background: #fee2e2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #dc2626;"></i>
                                </div>
                                <h3 style="color: #1e293b; margin-bottom: 12px;">Failed to Load Features</h3>
                                <p style="color: #64748b;">Error: ${error || 'Unknown error occurred'}</p>
                                <button class="btn btn-primary" onclick="window.location.reload()" style="margin-top: 20px; padding: 12px 24px; border-radius: 12px;">
                                    <i class="fas fa-sync-alt"></i> Reload Page
                                </button>
                            </div>
                        `);
                    }
                }
            });
        }

        // Calculate total amount for selected features
        function calculateTotal() {
            let total = 0;
            let hasValidFeatures = false;
            
            // Use data-price attribute first (more reliable)
            $('.feature-checkbox:checked').each(function() {
                const checkbox = $(this);
                let price = 0;
                
                // First try data-price attribute
                price = parseFloat(checkbox.attr('data-price'));
                
                // If data-price is not available or invalid, try fallback methods
                if (isNaN(price) || price <= 0) {
                    const featureCard = checkbox.closest('.feature-card-modern, .feature-card');
                    
                    // Try to find price in new design first
                    let priceText = featureCard.find('.feature-price-current').first().text();
                    if (!priceText || priceText.trim() === '') {
                        // Fallback to data attribute on card
                        priceText = featureCard.attr('data-feature-price');
                        if (!priceText) {
                            // Fallback to old design
                            priceText = featureCard.find('.text-success').first().text();
                        }
                    }
                    
                    // Parse price text
                    if (priceText && typeof priceText === 'string') {
                        price = parseFloat(priceText.replace(/[^0-9.-]+/g,""));
                    } else if (!isNaN(parseFloat(priceText))) {
                        price = parseFloat(priceText);
                    }
                    
                    // If we found a valid price, update the data-price attribute for future use
                    if (!isNaN(price) && price > 0) {
                        checkbox.attr('data-price', price);
                    }
                }
                
                // Add to total if price is valid
                if (!isNaN(price) && price > 0) {
                    total += price;
                    hasValidFeatures = true;
                } else {
                    // Log warning for debugging
                    const featureId = checkbox.val() || checkbox.attr('value') || 'unknown';
                    console.warn('Feature with ID', featureId, 'has invalid or missing price');
                }
            });
            
        // Update total display (modal + button badge)
        const totalText = '$' + total.toFixed(2);
        $('#totalAmount').text(totalText);
        $('#modalTotalAmount').text(totalText);
        $('#buttonTotalAmount').text(totalText);
            
            // Show/hide checkout button in modal based on selection
            if (total > 0 && hasValidFeatures) {
                $('#checkoutModalBtn').show();
                $('#addToCartModalBtn').show();
            } else {
                $('#checkoutModalBtn').hide();
            }
            
            return total;
        }

        // Add selected features to cart
                // Simplified and working add to cart function
        function addSelectedToCart() {
            const selectedFeatures = [];
            const selectedCheckboxes = document.querySelectorAll('.feature-checkbox:checked');

            if (selectedCheckboxes.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'No Features Selected',
                    text: 'Please select at least one feature to add to cart.'
                });
                return;
            }

            // Collect selected feature IDs (simplified approach)
            selectedCheckboxes.forEach(function(checkbox) {
                const featureId = parseInt(checkbox.value);
                if (!isNaN(featureId) && featureId > 0) {
                    selectedFeatures.push(featureId);
                    console.log('Adding feature to cart:', featureId);
                }
            });

            if (selectedFeatures.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Invalid Selection',
                    text: 'No valid features selected. Please try again.'
                });
                return;
            }

            // Show loading state
            const btn = document.getElementById('addToCartModalBtn');
            const originalHtml = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            btn.disabled = true;

            // Get CSRF token
            const token = $('input[name="__RequestVerificationToken"]').val();

            // Send ALL features in ONE request
            $.ajax({
                url: '/Features/AddMultipleToCart',
                method: 'POST',
                contentType: 'application/json',
                headers: {
                    'RequestVerificationToken': token
                },
                data: JSON.stringify({
                    featureIds: selectedFeatures
                }),
                success: function(data) {
                    btn.innerHTML = originalHtml;
                    btn.disabled = false;

                    if (data.success) {
                        // Success - redirect to payment summary
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: data.message || 'Features added to cart successfully!',
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = '/Payments/PaymentSummary';
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Failed',
                            text: data.message || 'Failed to add features to cart.'
                        });
                    }
                },
                error: function(xhr, status, error) {
                    btn.innerHTML = originalHtml;
                    btn.disabled = false;

                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'An error occurred while adding features to cart. Please try again.'
                    });
                }
            });
        }
                function addSelectedToCart() {
            const selectedFeatures = [];
            const selectedCheckboxes = document.querySelectorAll('.feature-checkbox:checked');

            if (selectedCheckboxes.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'No Features Selected',
                    text: 'Please select at least one feature to add to cart.'
                });
                return;
            }

            // Simple collection of feature IDs
            selectedCheckboxes.forEach(function(checkbox) {
                const featureId = parseInt(checkbox.value);
                if (!isNaN(featureId) && featureId > 0) {
                    selectedFeatures.push(featureId);
                    console.log('Selected feature ID:', featureId);
                }
            });

            if (selectedFeatures.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Invalid Selection',
                    text: 'No valid features selected. Please try again.'
                });
                return;
            }

            console.log('Sending features to server:', selectedFeatures);

            // Show loading state
            const btn = document.getElementById('addToCartModalBtn');
            const originalHtml = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            btn.disabled = true;

            // Get CSRF token
            const token = $('input[name="__RequestVerificationToken"]').val();
            console.log('CSRF Token:', token ? 'Present' : 'Missing');

            // Send ALL features in ONE request
            $.ajax({
                url: '/Features/AddMultipleToCart',
                method: 'POST',
                contentType: 'application/json',
                headers: {
                    'RequestVerificationToken': token
                },
                data: JSON.stringify({
                    featureIds: selectedFeatures
                }),
                success: function(data) {
                    console.log('Server response:', data);
                    btn.innerHTML = originalHtml;
                    btn.disabled = false;

                    if (data.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            html: data.message + `<br><small>Added: ${data.addedCount || 0}, Already in cart: ${data.alreadyInCartCount || 0}</small>`,
                            timer: 3000,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = '/Payments/PaymentSummary';
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Failed',
                            html: data.message + `<br><small>Errors: ${data.errorCount || 0}</small>`,
                            footer: data.error ? `Error: ${data.error}` : ''
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', { status: xhr.status, statusText: xhr.statusText, error: error });
                    btn.innerHTML = originalHtml;
                    btn.disabled = false;

                    Swal.fire({
                        icon: 'error',
                        title: 'Request Failed',
                        text: 'Network error: ' + error,
                        footer: 'Check browser console for details'
                    });
                }
            });
        }
        // Add feature to cart (single feature)
        function addToCart(featureId) {
            $.post('/Features/AddToCart', { 
                featureId: featureId,
                __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
            })
            .done(function(data) {
                if (data.success) {
                    // Update cart item count
                    $('#cartItemCount').text(data.totalItems);
                    
                    // Show checkout button if items in cart
                    if (data.totalItems > 0) {
                        $('#checkoutButton').show();
                    }
                    
                    // Show success message
                    Swal.fire({
                        title: 'Added to Cart!',
                        html: `<div style="display: flex; align-items: center; gap: 12px;">
                                  <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #4a6cf7, #667eea); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; color: white; font-size: 1.5rem;">
                                      <i class="fas fa-check"></i>
                                  </div>
                                  <div>
                                      <div style="font-weight: 600; font-size: 1.2rem;">Feature Added</div>
                                      <div style="color: #64748b;">has been added to your cart</div>
                                  </div>
                              </div>`,
                        icon: 'success',
                        timer: 2000,
                        timerProgressBar: true,
                        showConfirmButton: false,
                        toast: true,
                        position: 'top-end',
                        background: 'white'
                    });
                    
                    // Close modal
                    $('#featureModal').modal('hide');
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message || 'Failed to add feature to cart.'
                    });
                }
            })
            .fail(function() {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'An error occurred while adding the feature to cart.'
                });
            });
        }

        // Enhanced project editing
        function editProject(projectId) {
            // Add button loading state
            const button = event.target.closest('.btn');
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            button.disabled = true;

            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.disabled = false;

                Swal.fire({
                    title: 'Project Editor',
                    html: `<div style="text-align: center; padding: 20px;">
                              <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #4a6cf7, #667eea); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; color: white; font-size: 2rem;">
                                  <i class="fas fa-edit"></i>
                              </div>
                              <h3 style="margin-bottom: 10px;">Ready to Edit</h3>
                              <p style="color: #64748b;">You are now editing the selected project. Make your changes and save when done.</p>
                          </div>`,
                    confirmButtonText: 'Start Editing',
                    confirmButtonColor: '#4a6cf7',
                    showCancelButton: true,
                    cancelButtonText: 'Cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // In a real app, this would redirect to the editor
                        window.location.href = '/Books/Edit/' + projectId;
                    }
                });
            }, 1000);
        }

        // Enhanced pricing plans display
        function showPricingPlans() {
            // Mock plans data - in a real app, this would come from an API
            const plans = [
                { planId: 1, planName: "Starter", planRate: "9.99", planDays: 30, maxEBooks: 5, planDescription: "Perfect for new authors", supportLevel: "Standard", features: "Basic Publishing" },
                { planId: 2, planName: "Professional", planRate: "29.99", planDays: 30, maxEBooks: 20, planDescription: "For serious authors", supportLevel: "Priority", features: "Advanced Tools" },
                { planId: 3, planName: "Enterprise", planRate: "99.99", planDays: 30, maxEBooks: "Unlimited", planDescription: "For publishing teams", supportLevel: "Dedicated", features: "All Features" }
            ];

            let html = `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin: 20px 0;">`;

            plans.forEach((plan, index) => {
                const isPopular = index === 1; // Mark second plan as popular

                html += `
                    <div style="border: ${isPopular ? '2px solid #4a6cf7' : '2px solid #e2e8f0'};
                                border-radius: 16px;
                                padding: 30px;
                                text-align: center;
                                background: white;
                                position: relative;
                                transition: all 0.3s ease;
                                box-shadow: ${isPopular ? '0 10px 25px rgba(74, 108, 247, 0.15)' : '0 4px 6px rgba(0, 0, 0, 0.05)'};
                                transform: ${isPopular ? 'scale(1.05)' : 'scale(1)'};">
                        ${isPopular ? `<div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #4a6cf7; color: white; padding: 6px 20px; border-radius: 20px; font-size: 0.8rem; font-weight: 700;">MOST POPULAR</div>` : ''}
                        <h4 style="color: #4a6cf7; margin-bottom: 15px; font-size: 1.5rem;">${plan.planName}</h4>
                        <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 15px; color: #1e293b;">
                            $${plan.planRate}<span style="font-size: 1rem; color: #64748b;"> / ${plan.planDays} days</span>
                        </div>
                        <p style="margin-bottom: 20px; color: #64748b;">${plan.planDescription}</p>
                        <div style="text-align: left; margin-bottom: 25px;">
                            <p><strong>Max eBooks:</strong> ${plan.maxEBooks}</p>
                            <p><strong>Support:</strong> ${plan.supportLevel}</p>
                            <p><strong>Features:</strong> ${plan.features}</p>
                        </div>
                        <button class="btn ${isPopular ? 'btn-primary' : 'btn-secondary'}" onclick="selectPlan(${plan.planId})" style="width: 100%;">
                            Select ${plan.planName}
                        </button>
                    </div>
                `;
            });
            html += `</div>`;

            Swal.fire({
                title: '<div style="font-size: 2rem; font-weight: 800; background: linear-gradient(135deg, #4a6cf7, #667eea); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Choose Your Plan</div>',
                html: html,
                showConfirmButton: false,
                showCloseButton: true,
                width: '1000px'
            });
        }

        function selectPlan(planId) {
            Swal.fire({
                title: 'Confirm Selection',
                html: `<div style="text-align: center; padding: 10px;">
                          <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; color: white; font-size: 1.5rem;">
                              <i class="fas fa-check"></i>
                          </div>
                          <h3 style="margin-bottom: 10px;">Ready to Upgrade?</h3>
                          <p style="color: #64748b;">You'll be redirected to the secure checkout page.</p>
                      </div>`,
                showCancelButton: true,
                confirmButtonText: 'Continue to Checkout',
                confirmButtonColor: '#4a6cf7',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Redirect to the checkout page with the selected plan ID
                    window.location.href = `/Payments/Checkout?planId=${planId}`;
                }
            });
        }

        // Other existing functions remain the same but with enhanced UI
        function editCurrentBook() {
            Swal.fire({
                title: 'Edit Book',
                text: 'Opening book editor...',
                icon: 'info',
                timer: 1500,
                timerProgressBar: true,
                showConfirmButton: false
            }).then(() => {
                window.location.href = '/Books/Edit/12345';
            });
        }

        function viewBookDetails() {
            Swal.fire({
                title: 'Book Details',
                text: 'Loading book details...',
                icon: 'info',
                timer: 1500,
                timerProgressBar: true,
                showConfirmButton: false
            });
        }

        function previewProject(projectId) {
            Swal.fire({
                title: 'Project Preview',
                text: 'Loading project preview...',
                icon: 'info',
                timer: 1500,
                timerProgressBar: true,
                showConfirmButton: false
            }).then(() => {
                window.open('/Dashboard/LivePreview', '_blank');
            });
        }

        // New functions for enhanced content section with upgrade prompts
        function viewAnalytics() {
            Swal.fire({
                title: 'Upgrade Required',
                html: `<div style="text-align: center; padding: 20px;">
                          <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #4a6cf7, #667eea); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; color: white; font-size: 2rem;">
                              <i class="fas fa-chart-bar"></i>
                          </div>
                          <h3 style="margin-bottom: 10px;">Unlock Advanced Analytics</h3>
                          <p style="color: #64748b;">Get detailed insights into your readership, sales performance, and content engagement with our advanced analytics dashboard.</p>
                          <p style="color: #64748b;"><strong>Premium feature - Upgrade your plan to access.</strong></p>
                      </div>`,
                confirmButtonText: 'Upgrade Now',
                confirmButtonColor: '#4a6cf7',
                showCancelButton: true,
                cancelButtonText: 'Maybe Later'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Open pricing plans modal instead of redirecting
                    showPricingPlans();
                }
            });
        }

        function launchMarketing() {
            Swal.fire({
                title: 'Upgrade Required',
                html: `<div style="text-align: center; padding: 20px;">
                          <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; color: white; font-size: 2rem;">
                              <i class="fas fa-bullhorn"></i>
                          </div>
                          <h3 style="margin-bottom: 10px;">Unlock Marketing Tools</h3>
                          <p style="color: #64748b;">Promote your eBook effectively with our integrated marketing toolkit including social media campaigns and email marketing.</p>
                          <p style="color: #64748b;"><strong>Premium feature - Upgrade your plan to access.</strong></p>
                      </div>`,
                confirmButtonText: 'Upgrade Now',
                confirmButtonColor: '#f59e0b',
                showCancelButton: true,
                cancelButtonText: 'Maybe Later'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Open pricing plans modal instead of redirecting
                    showPricingPlans();
                }
            });
        }

        function engageReaders() {
            Swal.fire({
                title: 'Upgrade Required',
                html: `<div style="text-align: center; padding: 20px;">
                          <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; color: white; font-size: 2rem;">
                              <i class="fas fa-users"></i>
                          </div>
                          <h3 style="margin-bottom: 10px;">Unlock Reader Engagement</h3>
                          <p style="color: #64748b;">Connect with your readers and build a loyal audience for your work with our community building tools.</p>
                          <p style="color: #64748b;"><strong>Premium feature - Upgrade your plan to access.</strong></p>
                      </div>`,
                confirmButtonText: 'Upgrade Now',
                confirmButtonColor: '#10b981',
                showCancelButton: true,
                cancelButtonText: 'Maybe Later'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Open pricing plans modal instead of redirecting
                    showPricingPlans();
                }
            });
        }

        function showFeatureDetails() {
            Swal.fire({
                title: 'Premium Features',
                html: `
                    <div style="text-align: left; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                        <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #4a6cf7, #667eea); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; flex-shrink: 0;">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 8px 0;">AI Cover Design</h4>
                                <p style="margin: 0; color: #64748b;">Create professional book covers using artificial intelligence. Generate multiple designs based on your book's genre and content with just a few clicks.</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; flex-shrink: 0;">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 8px 0;">Audio Book Creation</h4>
                                <p style="margin: 0; color: #64748b;">Convert your written content into high-quality audiobooks with professional voice actors and studio-quality production. Reach listeners on all major platforms.</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; flex-shrink: 0;">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 8px 0;">Advanced Analytics</h4>
                                <p style="margin: 0; color: #64748b;">Get detailed insights into your readership, sales performance, and content engagement with our advanced analytics dashboard. Make data-driven decisions.</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: flex-start; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; flex-shrink: 0;">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 8px 0;">Priority Support</h4>
                                <p style="margin: 0; color: #64748b;">Get faster response times and dedicated support from our expert team for all your publishing needs. We're here to help you succeed.</p>
                            </div>
                        </div>
                    </div>
                `,
                showConfirmButton: false,
                showCloseButton: true,
                width: '650px'
            });
        }
    </script>
</body>
</html>