@{
    ViewData["Title"] = "My Books";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<style>
    :root {
        --primary: #7c3aed;
        --secondary: #06b6d4;
        --surface: #ffffff;
        --background: #f8fafc;
        --text-primary: #1e293b;
        --border: #e2e8f0;
        --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        --radius: 16px;
    }

    .page-container {
        width: 100%;
        padding: 30px;
        background: var(--background);
        min-height: 100vh;
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }

    .search-bar {
        background: var(--surface);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        padding: 20px;
        margin-bottom: 24px;
    }

    .search-bar input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border);
        border-radius: 8px;
        font-size: 1rem;
    }

    .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 24px;
    }

    .book-card {
        background: var(--surface);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        padding: 24px;
        transition: all 0.3s;
    }

    .book-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    }

    .book-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 12px;
        color: var(--text-primary);
    }

    .book-meta {
        color: #64748b;
        font-size: 0.9rem;
        margin-bottom: 16px;
    }

    .book-status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 16px;
    }

    .status-draft { background: #fef3c7; color: #92400e; }
    .status-published { background: #d1fae5; color: #065f46; }
    .status-generated { background: #dbeafe; color: #1e40af; }

    .book-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s;
    }

    .btn-primary {
        background: var(--primary);
        color: white;
    }

    .btn-success {
        background: #10b981;
        color: white;
    }

    .btn-danger {
        background: #ef4444;
        color: white;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
</style>

<div class="page-container">
    <div class="page-header">
        <h1><i class="fas fa-book"></i> My Books</h1>
        <p>Manage all your created books</p>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" id="bookSearch" placeholder="Search books by title, status, or date..." onkeyup="filterBooks()">
    </div>

    <!-- Books Grid -->
    <div class="books-grid" id="booksList">
        @if (ViewBag.Books != null && ((IEnumerable<dynamic>)ViewBag.Books).Any())
        {
            @foreach (var book in ViewBag.Books)
            {
                <div class="book-card" data-title="@book.Title.ToLower()" data-status="@book.Status.ToLower()">
                    <div class="book-title">@book.Title</div>
                    <div class="book-meta">
                        <div><i class="fas fa-calendar"></i> Created: @book.CreatedAt.ToString("MMM dd, yyyy")</div>
                        <div><i class="fas fa-clock"></i> Time: @book.CreatedAt.ToString("hh:mm tt")</div>
                        <div><i class="fas fa-file-alt"></i> Chapters: @book.ChapterCount</div>
                    </div>
                    <div>
                        <span class="book-status status-@book.Status.ToLower()">@book.Status</span>
                    </div>
                    <div class="book-actions">
                        <button class="btn btn-primary" onclick="editBook(@book.BookId)">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-success" onclick="publishBook(@book.BookId)">
                            <i class="fas fa-upload"></i> Publish
                        </button>
                        <button class="btn btn-danger" onclick="deleteBook(@book.BookId)">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="book-card" style="grid-column: 1 / -1; text-align: center; padding: 60px;">
                <h3 class="text-muted">No books found</h3>
                <p class="text-muted">Create your first book using AI Writer or Book Creation!</p>
                <a href="/Books/AIGenerateBook" class="btn btn-primary" style="margin-top: 20px;">
                    <i class="fas fa-plus"></i> Create New Book
                </a>
            </div>
        }
    </div>
</div>

<script>
    function filterBooks() {
        const search = document.getElementById('bookSearch').value.toLowerCase();
        document.querySelectorAll('.book-card').forEach(card => {
            const title = card.dataset.title || '';
            const status = card.dataset.status || '';
            const matches = title.includes(search) || status.includes(search);
            card.style.display = matches ? 'block' : 'none';
        });
    }

    function editBook(bookId) {
        window.location.href = `/Books/AIGenerateBook?bookId=${bookId}`;
    }

    async function publishBook(bookId) {
        if (confirm('Publish this book? This is a paid feature and will redirect to payment.')) {
            window.location.href = `/Payments/Checkout?bookId=${bookId}`;
        }
    }

    async function deleteBook(bookId) {
        if (confirm('Are you sure you want to delete this book? This action cannot be undone.')) {
            try {
                const res = await fetch(`/Books/Delete/${bookId}`, { 
                    method: 'POST',
                    headers: {
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    }
                });
                
                if (res.ok) {
                    location.reload();
                } else {
                    alert('Failed to delete book');
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }
    }
</script>

